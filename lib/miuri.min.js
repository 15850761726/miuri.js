(function(){var t,r,e,i,n,o,s,p,u,a,h,f={}.hasOwnProperty;h=/^(?:([A-Za-z-+\.]+):\/\/)?(?:(\w+)(?::(\w+))?@)?([^:\/]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.+))?/;a=["protocol","username","password","host","port","path","query","fragment"];o=typeof window!=="undefined"&&window!==null?false:true;p=function(t){var r,e,i,n,o,s;if(!h.test(t)){throw"Invalid uri"}e=h.exec(t).slice(1);n={};for(r=o=0,s=a.length;o<s;r=++o){i=a[r];n[i]=e[r]}return n};n=function(t){return"[object Array]"===Object.prototype.toString.call(t)};s=function(t){return"[object Object]"===Object.prototype.toString.call(t)};i=function(t,r){var e,i;for(e in r){if(!f.call(r,e))continue;i=r[e];t[e]=i}};u=function(t){var r,e,i,o,p,u,a,h,f,c;e=/\[([^\]]*)\]/;r={};f=t.split("&");for(a=0,h=f.length;a<h;a++){o=f[a];c=o.split("="),i=c[0],u=c[1];p=e.exec(i);u=decodeURIComponent(u);if(!p){r[i]=u;continue}if(p[1]&&!s(r[i])){r[i]={}}else if(!n(r[i])){r[i]=[]}if(p[1]){r[i][p[1]]=u}else{r[i].push(u)}}return r};e=function(t,r){var e,i,o,p;if(!n(r)&&!s(r)){return""+t+"="+encodeURIComponent(r)}a=[];if(n(r)){for(o=0,p=r.length;o<p;o++){e=r[o];a.push(""+t+"[]="+encodeURIComponent(e))}}if(s(r)){for(i in r){if(!f.call(r,i))continue;e=r[i];a.push(""+t+"["+i+"]="+encodeURIComponent(e))}}return a.join("&")};r="/";if(typeof window!=="undefined"&&window!==null&&window.location.host){r=window.location.href}t=function(){function t(t){this.uri=t!=null?t:r;this.parts=p(this.uri);this.parts.query=this.parts.query?u(this.parts.query):{};if(!this.parts.path){this.parts.path="/"}return}t.prototype.retrieve=function(t,r){if(r==null){r=null}if(r===null){return this.parts[t]}this.parts[t]=r;return this};t.prototype.protocol=function(t){return this.retrieve("protocol",t)};t.prototype.username=function(t){return this.retrieve("username",t)};t.prototype.password=function(t){return this.retrieve("password",t)};t.prototype.host=function(t){return this.retrieve("host",t)};t.prototype.hostname=function(t){return this.host(t)};t.prototype.port=function(t){return this.retrieve("port",t)};t.prototype.path=function(t){if(t&&t[0]!=="/"){t="/"+t}return this.retrieve("path",t)};t.prototype.query=function(t,r){if(t&&typeof t==="string"){if(!r){return this.parts.query[t]}else{this.parts.query[t]=r;return this}}if(s(t)){i(this.parts.query,t);return this}return this.parts.query};t.prototype.fragment=function(t){return this.retrieve("fragment",t)};t.prototype.toString=function(){var t,r,i,n,o;i="";if(this.parts.protocol&&this.parts.host){i+=""+this.parts.protocol+"://";if(this.parts.username&&this.parts.password){i+=""+this.parts.username+":"+this.parts.password+"@"}else if(this.parts.username){i+=""+this.parts.username+"@"}i+=this.parts.host;if(this.parts.port){i+=":"+this.parts.port}}i+=this.parts.path;r=[];o=this.parts.query;for(t in o){if(!f.call(o,t))continue;n=o[t];r.push(e(t,n))}if(r.length>0){i+="?"+r.join("&")}if(this.parts.fragment){i+="#"+this.parts.fragment}return i};return t}();if(o){module.exports=t}else{this.miuri=t}}).call(this);